<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <title>AR Marker Recognition</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .ar-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        .instructions {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            text-align: center;
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1001;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            -webkit-tap-highlight-color: transparent;
        }
        
        .back-button:hover,
        .back-button:active {
            background: #0056b3;
            transform: scale(0.95);
        }
        
        .camera-selector {
            position: absolute;
            top: 80px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            display: none;
        }
        
        .camera-selector select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: none;
            background: white;
            color: black;
            margin-top: 10px;
        }
        
        .camera-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1001;
            font-size: 16px;
            font-weight: 500;
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            -webkit-tap-highlight-color: transparent;
        }
        
        .camera-toggle:hover,
        .camera-toggle:active {
            background: #218838;
            transform: scale(0.95);
        }

        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã®ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒª */
        @media (max-width: 768px) {
            .back-button {
                top: 15px;
                right: 15px;
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .camera-toggle {
                top: 15px;
                left: 15px;
                padding: 10px 14px;
                font-size: 14px;
            }
            
            .instructions {
                top: 15px;
                left: 15px;
                right: 15px;
                padding: 12px;
                font-size: 14px;
            }
            
            .camera-selector {
                top: 70px;
                left: 15px;
                right: 15px;
                padding: 12px;
            }
            
            .camera-selector select {
                font-size: 16px; /* iOSã§ã®ã‚ºãƒ¼ãƒ é˜²æ­¢ */
                padding: 12px 8px;
            }
            
            .camera-selector button {
                padding: 12px;
                font-size: 16px;
                min-height: 44px;
            }
        }

        /* ç¸¦ç”»é¢ãƒ¢ãƒã‚¤ãƒ«ç”¨ */
        @media (max-width: 480px) and (orientation: portrait) {
            .back-button {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .camera-toggle {
                top: 10px;
                left: 10px;
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .instructions {
                top: 10px;
                left: 10px;
                right: 10px;
                padding: 10px;
                font-size: 12px;
            }
            
            .camera-selector {
                top: 60px;
                left: 10px;
                right: 10px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="ar-container">
        <a href="/" class="back-button">â† æˆ»ã‚‹</a>
        <button class="camera-toggle" onclick="toggleCameraSelector()">ğŸ“· ã‚«ãƒ¡ãƒ©é¸æŠ</button>
        
        <div class="camera-selector" id="cameraSelector">
            <h4>ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠ</h4>
            <p style="font-size: 12px; margin: 5px 0; color: #ccc;">
                åˆå›ã¯ã‚«ãƒ¡ãƒ©ã®è¨±å¯ãŒå¿…è¦ã§ã™ã€‚è©³ç´°ãªãƒ‡ãƒã‚¤ã‚¹åã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ã€ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚
            </p>
            <select id="cameraSelect">
                <option value="">ã‚«ãƒ¡ãƒ©ã‚’æ¤œç´¢ä¸­...</option>
            </select>
            <button onclick="applyCameraSelection()" style="
                width: 100%;
                padding: 10px;
                margin-top: 10px;
                background: #007bff;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            ">ã‚«ãƒ¡ãƒ©ã‚’é©ç”¨</button>
            <div id="cameraDebugInfo" style="
                font-size: 10px;
                color: #ccc;
                margin-top: 5px;
                padding: 5px;
                background: rgba(0,0,0,0.3);
                border-radius: 3px;
                display: none;
            "></div>
            <button onclick="refreshCameraList()" style="
                width: 100%;
                padding: 8px;
                margin-top: 5px;
                background: #6c757d;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 12px;
            ">ã‚«ãƒ¡ãƒ©ä¸€è¦§ã‚’æ›´æ–°</button>
        </div>

        <!-- A-Frame AR Scene -->
        <a-scene
            vr-mode-ui="enabled: false;"
            renderer="logarithmicDepthBuffer: true; colorManagement: true;"
            embedded
            arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; sourceWidth: 1280; sourceHeight: 720; displayWidth: 1280; displayHeight: 720;"
            id="arScene">
            
            <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ç”¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ -->
            <a-marker id="custom-marker" type="pattern" url="./markers/pattern.patt">
                <!-- 3Dãƒ¢ãƒ‡ãƒ« -->
                <a-gltf-model src="./models/scene.gltf" scale="0.0025 0.0025 0.0025" position="0 0.5 0"></a-gltf-model>
                
                <!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®åŸºæœ¬å½¢çŠ¶ -->
                <a-box position="0 0.5 0" material="color: red;" rotation="0 45 0" visible="false"></a-box>
                <a-sphere position="1 1 0" material="color: blue;" radius="0.3" visible="false"></a-sphere>
                <a-cylinder position="-1 1 0" material="color: green;" radius="0.3" height="1" visible="false"></a-cylinder>
                <a-cone position="0 2 0" material="color: yellow;" radius-bottom="0.5" height="1" visible="false"></a-cone>
            </a-marker>

            <!-- ã‚«ãƒ¡ãƒ©è¨­å®š -->
            <a-entity camera></a-entity>
        </a-scene>
    </div>

    <script>
        let availableCameras = [];
        let currentCameraId = null;

        // ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã‹ã©ã†ã‹ã‚’åˆ¤å®š
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   (window.innerWidth <= 768);
        }

        // ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        async function getCameraDevices() {
            try {
                // ãƒ¢ãƒã‚¤ãƒ«ç”¨ã®ã‚«ãƒ¡ãƒ©è¨­å®š
                const constraints = {
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: isMobile() ? { ideal: 'environment' } : 'user' // ãƒ¢ãƒã‚¤ãƒ«ã§ã¯èƒŒé¢ã‚«ãƒ¡ãƒ©ã‚’å„ªå…ˆ
                    }
                };
                
                // ã¾ãšä¸€æ™‚çš„ã«ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚’å–å¾—ã—ã¦ãƒ‡ãƒã‚¤ã‚¹åã‚’å–å¾—
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                
                // ã‚«ãƒ¡ãƒ©ã®è©³ç´°æƒ…å ±ã‚’å–å¾—
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                availableCameras = videoDevices;
                
                // ä¸€æ™‚çš„ãªã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢
                stream.getTracks().forEach(track => track.stop());
                
                const select = document.getElementById('cameraSelect');
                select.innerHTML = '';
                
                if (videoDevices.length === 0) {
                    select.innerHTML = '<option value="">ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>';
                    return;
                }
                
                videoDevices.forEach((device, index) => {
                    const option = document.createElement('option');
                    option.value = device.deviceId;
                    
                    // ãƒ‡ãƒã‚¤ã‚¹åã‚’ã‚ˆã‚Šè©³ç´°ã«è¡¨ç¤º
                    let deviceName = device.label;
                    if (!deviceName || deviceName === '') {
                        // ãƒ‡ãƒã‚¤ã‚¹åãŒå–å¾—ã§ããªã„å ´åˆã€ã‚ˆã‚Šè©³ç´°ãªæƒ…å ±ã‚’è¡¨ç¤º
                        deviceName = `ã‚«ãƒ¡ãƒ© ${index + 1} (ID: ${device.deviceId.substring(0, 8)}...)`;
                    }
                    
                    option.textContent = deviceName;
                    select.appendChild(option);
                });
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ€åˆã®ã‚«ãƒ¡ãƒ©ã‚’é¸æŠ
                if (videoDevices.length > 0) {
                    select.value = videoDevices[0].deviceId;
                    currentCameraId = videoDevices[0].deviceId;
                }
                
            } catch (error) {
                console.error('ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                
                // ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚ŒãŸå ´åˆã€åŸºæœ¬çš„ãªæƒ…å ±ã®ã¿è¡¨ç¤º
                try {
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    const videoDevices = devices.filter(device => device.kind === 'videoinput');
                    
                    const select = document.getElementById('cameraSelect');
                    select.innerHTML = '';
                    
                    if (videoDevices.length === 0) {
                        select.innerHTML = '<option value="">ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>';
                        return;
                    }
                    
                    videoDevices.forEach((device, index) => {
                        const option = document.createElement('option');
                        option.value = device.deviceId;
                        option.textContent = `ã‚«ãƒ¡ãƒ© ${index + 1} (è©³ç´°æƒ…å ±ã¯ã‚«ãƒ¡ãƒ©è¨±å¯å¾Œã«è¡¨ç¤º)`;
                        select.appendChild(option);
                    });
                    
                    if (videoDevices.length > 0) {
                        select.value = videoDevices[0].deviceId;
                        currentCameraId = videoDevices[0].deviceId;
                    }
                    
                } catch (fallbackError) {
                    console.error('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚‚å¤±æ•—ã—ã¾ã—ãŸ:', fallbackError);
                    document.getElementById('cameraSelect').innerHTML = '<option value="">ã‚«ãƒ¡ãƒ©ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</option>';
                }
            }
        }

        // ã‚«ãƒ¡ãƒ©ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
        function toggleCameraSelector() {
            const selector = document.getElementById('cameraSelector');
            const debugInfo = document.getElementById('cameraDebugInfo');
            
            if (selector.style.display === 'none' || selector.style.display === '') {
                selector.style.display = 'block';
                debugInfo.style.display = 'block';
                
                // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’æ›´æ–°
                updateDebugInfo();
                
                if (availableCameras.length === 0) {
                    getCameraDevices();
                }
            } else {
                selector.style.display = 'none';
                debugInfo.style.display = 'none';
            }
        }

        // ã‚«ãƒ¡ãƒ©ä¸€è¦§ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        async function refreshCameraList() {
            const select = document.getElementById('cameraSelect');
            select.innerHTML = '<option value="">ã‚«ãƒ¡ãƒ©ã‚’å†æ¤œç´¢ä¸­...</option>';
            
            // åˆ©ç”¨å¯èƒ½ãªã‚«ãƒ¡ãƒ©ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
            availableCameras = [];
            
            // ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ã‚’å†å–å¾—
            await getCameraDevices();
        }

        // é¸æŠã•ã‚ŒãŸã‚«ãƒ¡ãƒ©ã‚’é©ç”¨
        async function applyCameraSelection() {
            const selectedCameraId = document.getElementById('cameraSelect').value;
            if (!selectedCameraId) {
                alert('ã‚«ãƒ¡ãƒ©ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            if (selectedCameraId === currentCameraId) {
                alert('åŒã˜ã‚«ãƒ¡ãƒ©ãŒæ—¢ã«é¸æŠã•ã‚Œã¦ã„ã¾ã™');
                return;
            }
            
            try {
                // é¸æŠã•ã‚ŒãŸã‚«ãƒ¡ãƒ©ã§ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å–å¾—ï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼‰
                const constraints = {
                    video: {
                        deviceId: { exact: selectedCameraId },
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: isMobile() ? { ideal: 'environment' } : undefined
                    }
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                
                // AR.jsã®ã‚«ãƒ¡ãƒ©ã‚½ãƒ¼ã‚¹ã‚’æ›´æ–°
                const scene = document.querySelector('a-scene');
                const arjs = scene.components.arjs;
                
                if (arjs && arjs.data && arjs.data.sourceType === 'webcam') {
                    // æ—¢å­˜ã®ãƒ“ãƒ‡ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢
                    if (arjs.videoElement && arjs.videoElement.srcObject) {
                        const oldStream = arjs.videoElement.srcObject;
                        oldStream.getTracks().forEach(track => track.stop());
                    }
                    
                    // æ–°ã—ã„ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è¨­å®š
                    arjs.videoElement.srcObject = stream;
                    
                    // AR.jsã‚’å†åˆæœŸåŒ–
                    arjs.play();
                }
                
                currentCameraId = selectedCameraId;
                
                // ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                document.getElementById('cameraSelector').style.display = 'none';
                
                console.log('ã‚«ãƒ¡ãƒ©ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ:', selectedCameraId);
                
            } catch (error) {
                console.error('ã‚«ãƒ¡ãƒ©ã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                alert('ã‚«ãƒ¡ãƒ©ã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // ãƒãƒ¼ã‚«ãƒ¼ãŒèªè­˜ã•ã‚ŒãŸæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener('DOMContentLoaded', function() {
            const scene = document.querySelector('a-scene');
            
            // ãƒ¢ãƒã‚¤ãƒ«ç”¨ã®åˆæœŸè¨­å®š
            if (isMobile()) {
                console.log('ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã‚’æ¤œå‡ºã—ã¾ã—ãŸ');
                // iOS Safariç”¨ã®è¨­å®š
                if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                    document.body.style.webkitTransform = 'translateZ(0)';
                    document.body.style.transform = 'translateZ(0)';
                }
            }
            
            // ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ã‚’å–å¾—
            getCameraDevices();
            
            // AR.jsãŒå®Œå…¨ã«åˆæœŸåŒ–ã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
            scene.addEventListener('loaded', function() {
                console.log('AR.js scene loaded');
                
                // åˆæœŸã‚«ãƒ¡ãƒ©IDã‚’è¨­å®š
                const arjs = scene.components.arjs;
                if (arjs && arjs.videoElement && arjs.videoElement.srcObject) {
                    // ç¾åœ¨ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‹ã‚‰ãƒ‡ãƒã‚¤ã‚¹IDã‚’å–å¾—
                    const track = arjs.videoElement.srcObject.getVideoTracks()[0];
                    if (track) {
                        const settings = track.getSettings();
                        currentCameraId = settings.deviceId;
                        console.log('Initial camera ID:', currentCameraId);
                    }
                }
                
                // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’å®šæœŸçš„ã«æ›´æ–°
                setInterval(updateMainDebugInfo, 1000);
            });
            
            // ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ãŒèªè­˜ã•ã‚ŒãŸæ™‚
            const customMarker = document.querySelector('#custom-marker');
            customMarker.addEventListener('markerFound', function() {
                console.log('Pattern marker found!');
                console.log('Pattern marker object3D visible:', customMarker.object3D.visible);
                
                // 3Dãƒ¢ãƒ‡ãƒ«ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                const model = document.querySelector('#custom-marker a-gltf-model');
                if (model) {
                    model.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 5000; easing: linear');
                    console.log('Pattern GLTF model animation added');
                } else {
                    console.log('Pattern GLTF model not found');
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢çŠ¶ã‚’è¡¨ç¤º
                    const box = document.querySelector('#custom-marker a-box');
                    if (box) {
                        box.setAttribute('visible', 'true');
                        box.setAttribute('animation', 'property: rotation; to: 0 405 0; dur: 2000; easing: linear');
                        console.log('Pattern box fallback animation added');
                    }
                }
            });
            
            customMarker.addEventListener('markerLost', function() {
                console.log('Pattern marker lost!');
            });

            // 3Dãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ
            const gltfModels = document.querySelectorAll('a-gltf-model');
            gltfModels.forEach((model, index) => {
                model.addEventListener('model-loaded', function() {
                    console.log(`3Dãƒ¢ãƒ‡ãƒ« ${index + 1} èª­ã¿è¾¼ã¿å®Œäº†`);
                });
                
                model.addEventListener('model-error', function(event) {
                    console.error(`3Dãƒ¢ãƒ‡ãƒ« ${index + 1} èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:`, event.detail);
                    const modelStatus = document.getElementById('modelStatus');
                    modelStatus.textContent = `3Dãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${event.detail}`;
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢çŠ¶ã‚’è¡¨ç¤º
                    const marker = model.closest('a-marker');
                    const fallbacks = marker.querySelectorAll('[visible="false"]');
                    fallbacks.forEach(fallback => {
                        fallback.setAttribute('visible', 'true');
                    });
                    console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢çŠ¶ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
                });
            });

            // 5ç§’å¾Œã«3Dãƒ¢ãƒ‡ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¡¨ç¤º
            setTimeout(() => {
                gltfModels.forEach((model, index) => {
                    if (model.object3D.children.length === 0) {
                        console.log(`3Dãƒ¢ãƒ‡ãƒ« ${index + 1} ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢çŠ¶ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚`);
                        const marker = model.closest('a-marker');
                        const fallbacks = marker.querySelectorAll('[visible="false"]');
                        fallbacks.forEach(fallback => {
                            fallback.setAttribute('visible', 'true');
                        });
                    }
                });
            }, 5000);
        });
    </script>
</body>
</html>
